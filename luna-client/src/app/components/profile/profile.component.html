<div class="container align-center">
    <div class="row mt-5" *ngIf="!isLoggedIn">
        <div class="col">
            <p align="center"><mat-spinner></mat-spinner></p>
        </div>
    </div>
    <div class="row mt-5" *ngIf="isLoggedIn">
        <div class="col">
            <div class="container" *ngIf="!isEditing">
                <h1>Welcome {{username}}!</h1>
                <h2>Your Divination Readings</h2>
                <p align="center"><mat-spinner *ngIf="isLoading"></mat-spinner></p>
                <div *ngIf="cardlists.length <= 0">
                    <p>You do not have any divination readings!</p>
                    <p><button mat-fab color="primary" [routerLink]="['/account/cardlist/create']">
                            <mat-icon>add</mat-icon>
                        </button></p>
                </div>
                <div *ngIf="!isLoading">
                    <div class="row">
                        <div class="col-md-auto" *ngFor="let c of cardlist">
                            <p align="right">
                                <button mat-icon-button class="example-icon" [matMenuTriggerFor]="menu"
                                    aria-label="settings" color="primary">
                                    <mat-icon>Readings</mat-icon>
                                </button>
                                <mat-menu #menu="matMenu">
                                    <button mat-menu-item (click)="onEdit(c.cardListId)" style="color:purple;">
                                        <mat-icon style="color:purple;">edit</mat-icon>
                                        <span>Edit</span>
                                    </button>
                                    <button mat-menu-item (click)="onDelete(c.cardListId)" style="color:red;">
                                        <mat-icon style="color:red;">delete</mat-icon>
                                        <span>Delete</span>
                                    </button>
                                </mat-menu>
                            </p>
                            <p>
                                <a [routerLink]="['/cardlist', 'user', c.cardListId]">
                                    <img *ngIf="!c.user" width="200" height="auto">
                                    <img *ngIf="c.user"  width="200" height="auto"></a>
                            </p>
                            <p><a [routerLink]="['/cardlist', 'user', c.cardListId]">{{c.name}}</a></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container align-center" *ngIf="isEditing">
            <div class="row">
                <div class="col" *ngIf="!isLoading">
                    <button type="button" mat-mini-fab color="primary" (click)="cancelEdit()">
                        <mat-icon>arrow_back</mat-icon>
                    </button>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <h2 class="mt-3">Edit Divination</h2>
                    <p align="center">
                        <mat-spinner *ngIf="isLoading"></mat-spinner>
                    </p>
                    <form *ngIf="!isLoading" [formGroup]="form" (ngSubmit)="onSubmitEdit()">
                        <input type="hidden" formControlName="cardListId">
                        <table class="table">
                            <tr>
                                <td>
                                    <mat-form-field appearance="outline">
                                        <mat-label>Name</mat-label>
                                        <input type="text" formControlName="name" matInput>
                                    </mat-form-field>
                                </td>
                            </tr>
                        
                            <tr>
                                <td>
                                    <mat-form-field appearance="fill" style="width: 80%;">
                                        <mat-label>Instructions</mat-label>
                                        <textarea matInput rows="10" formControlName="instructions"></textarea>
                                    </mat-form-field>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <mat-form-field appearance="outline">
                                        <mat-label>Youtube link</mat-label>
                                        <input type="url" formControlName="youtubeLink" matInput>
                                    </mat-form-field>
                                </td>
                            </tr>
                        </table>
                        <div class="row">
                            <h2>Ingredients</h2>
                            <div class="col" formArrayName="ingredients">
                                <div class="row mt-3"
                                    *ngFor="let ingredient of ingredientsArray.controls; let i = index"
                                    [formGroup]="ingredient">
                                    <div class="col">
                                        <mat-form-field appearance="outline" style="width: 90%">
                                            <mat-label>Measurement</mat-label>
                                            <input type="text" formControlName="measurement" matInput>
                                        </mat-form-field>
                                    </div>
                                    <div class="col">
                                        <mat-form-field appearance="outline" style="width: 90%">
                                            <mat-label>Ingredient</mat-label>
                                            <input type="text" formControlName="ingredient" matInput>
                                        </mat-form-field>
                                    </div>
                                    <div class="col-md-auto">
                                        <button type="button" (click)="onRemoveIngredient(i)" mat-mini-fab
                                            color="primary">
                                            <mat-icon>delete</mat-icon>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col">
                                <button type="button" (click)="onAddIngredient()" mat-fab color="primary">
                                    <mat-icon>add_circle</mat-icon>
                                </button>
                            </div>
                        </div>
                        <div class="row mt-5 mb-5">
                            <div class="col">
                                <button type="submit" [disabled]="form.invalid" mat-flat-button color="primary">Submit</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>